#!groovy

pipeline {

    parameters {
      string(name: "SLAVE_TARGET", defaultValue: "master", description: "slave machine that responsible to execute tasks")
	  string(name: "BUILD_DIR", defaultValue: "D:/Testing/jmeter", description: "")
      string(name: "DEPLOY_DIR", defaultValue: "D:/BUILD_Packages/QA/Batch", description: "")	  
  }
  
   agent { label "${SLAVE_TARGET}" }
   
   stages {	 
	   stage("publish Resullts with ant")
	   {
	   steps
	   {
		  dir('C:/jmeter/extras') 
		  {
			 // def antHome = tool 'ant'
     		     //  bat "pushd c:\\jmeter\\extras && c:\\ant\\bin\\ant -f build.xml"
			  //step([$class: 'ArtifactArchiver', artifacts: 'devtestreport.html', fingerprint: true])
			 bat ("C:/jmeter/bin/jmeter.bat -Jjmeter.save.saveservice.output_format=xml -n -t D:/Testing/jmeter/urltestscript.jmx -l D:/Testing/jmeter/devtestreport.jtl")
	          step([$class: 'ArtifactArchiver', artifacts: '**/*.jtl, **/jmeter.log'])
			  perfReport 'result.csv'
			  performanceReport parsers: [[$class: 'JMeterParser', glob: 'result.xml']], relativeFailedThresholdNegative: 1.2, relativeFailedThresholdPositive: 1.89, relativeUnstableThresholdNegative: 1.8, relativeUnstableThresholdPositive: 1.5
	     
       			
           }   
	   }
	   } 
     
   }
	
}
